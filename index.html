<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>í˜‘ë™ì¡°í•© ERP (ë¡œê·¸ì¸)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    body { background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    .login-card { width: 100%; max-width: 400px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; }
  </style>
</head>
<body>

  <div class="login-card">
    <h3 class="fw-bold mb-4">âš¡ í˜‘ë™ì¡°í•© ERP</h3>
    
    <div id="loginForm">
      <p class="text-muted mb-4 small">
        ë“±ë¡ëœ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>
        ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì•ˆì „í•˜ê²Œ ì ‘ì†í•˜ì„¸ìš”.
      </p>

      <div class="mb-3 text-start">
        <label class="form-label">ì´ë©”ì¼ ì£¼ì†Œ</label>
        <input type="email" class="form-control" id="emailInput" placeholder="name@coop.com">
      </div>

      <button class="btn btn-primary w-100 py-2" id="btnSend" onclick="sendMagicLink()">
        ğŸ“§ ë¡œê·¸ì¸ ë§í¬ ë°›ê¸°
      </button>
      
      <div id="statusMsg" class="mt-3 text-success small" style="display:none;"></div>
    </div>
  </div>

<script>
// ============================================================
// [ì„¤ì •] ìˆ˜í¼ë² ì´ìŠ¤ ì—°ê²° ì •ë³´
// ============================================================
const SUPABASE_URL = 'https://ifdqlwxgqgsvnawmhlfc.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmZHFsd3hncWdzdm5hd21obGZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxODQ3NDIsImV4cCI6MjA4Mjc2MDc0Mn0.UKUvMOl58KuDH24seC3oSgla7mK5lr-vXjqtpalnl6k';

// [ìˆ˜ì • í¬ì¸íŠ¸] ë³€ìˆ˜ ì´ë¦„ì„ supabase -> _supabase ë¡œ ë³€ê²½ (ì¶©ëŒ ë°©ì§€)
const _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// [ì¤‘ìš”] ë¡œê·¸ì¸ í›„ ì´ë™í•  ì£¼ì†Œ
const REDIRECT_URL = 'https://minho-kim.github.io/yonginsolar_erp/approval.html'; 

// 1. ì´ë¯¸ ë¡œê·¸ì¸ ë˜ì–´ ìˆëŠ”ì§€ ì²´í¬ (ìë™ ë¡œê·¸ì¸)
window.onload = async function() {
    // ë³€ìˆ˜ëª… ë³€ê²½ ë°˜ì˜ (_supabase)
    const { data: { session } } = await _supabase.auth.getSession();
    if (session) {
        location.href = 'approval.html';
    }
};

// 2. ë§¤ì§ ë§í¬ ë°œì†¡ í•¨ìˆ˜
async function sendMagicLink() {
    const email = document.getElementById('emailInput').value;
    const btn = document.getElementById('btnSend');
    const msg = document.getElementById('statusMsg');

    if (!email) return alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    btn.disabled = true;
    btn.innerText = "ì „ì†¡ ì¤‘...";

    // ë³€ìˆ˜ëª… ë³€ê²½ ë°˜ì˜ (_supabase)
    const { error } = await _supabase.auth.signInWithOtp({
        email: email,
        options: {
            emailRedirectTo: REDIRECT_URL 
        }
    });

    if (error) {
        alert("ì „ì†¡ ì‹¤íŒ¨: " + error.message);
        btn.disabled = false;
        btn.innerText = "ğŸ“§ ë¡œê·¸ì¸ ë§í¬ ë°›ê¸°";
    } else {
        btn.classList.add("d-none");
        msg.style.display = "block";
        msg.innerHTML = `
            <strong>ğŸ“© ì „ì†¡ ì™„ë£Œ!</strong><br>
            ë©”ì¼í•¨ì„ í™•ì¸í•˜ê³  ë¡œê·¸ì¸ ë§í¬ë¥¼ í´ë¦­í•˜ì„¸ìš”.<br>
            (ìŠ¤íŒ¸ ë©”ì¼í•¨ë„ í™•ì¸í•´ì£¼ì„¸ìš”)
        `;
    }
}
</script>
</body>
</html>
